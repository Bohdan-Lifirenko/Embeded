–ù–∞–¥–∞—é –ø—Ä–æ—Å—Ç–µ –π —á—ñ—Ç–∫–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è **AAPCS** —Ç–∞–∫, —â–æ–± —Ç–∏ –º—ñ–≥ –∑—Ä–æ–∑—É–º—ñ—Ç–∏, —è–∫ –≤–æ–Ω–æ –ø—Ä–∞—Ü—é—î –≤ —Ä–µ–∞–ª—å–Ω–∏—Ö ARM-–ø—Ä–æ—Ü–µ—Å–æ—Ä–∞—Ö (Cortex-M, Cortex-A) —ñ —á–æ–º—É –≤–æ–Ω–æ –≤–∞–∂–ª–∏–≤–µ –¥–ª—è embedded.

---

# üü¶ **–©–æ —Ç–∞–∫–µ AAPCS?**

**AAPCS (ARM Architecture Procedure Call Standard)** ‚Äî —Ü–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç, —è–∫–∏–π –≤–∏–∑–Ω–∞—á–∞—î:

* —è–∫ —Ñ—É–Ω–∫—Ü—ñ—ó –æ—Ç—Ä–∏–º—É—é—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç–∏,
* —è–∫ —Ñ—É–Ω–∫—Ü—ñ—ó –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è,
* —è–∫—ñ —Ä–µ–≥—ñ—Å—Ç—Ä–∏ –º–æ–∂–Ω–∞ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É–≤–∞—Ç–∏,
* —è–∫ —Ñ–æ—Ä–º—É—î—Ç—å—Å—è —Å—Ç–µ–∫,
* —è–∫ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –≤–∏–∫–ª–∏–∫ —ñ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∑ —Ñ—É–Ω–∫—Ü—ñ–π.

–Ü–Ω—à–∏–º–∏ —Å–ª–æ–≤–∞–º–∏:
üëâ **AAPCS ‚Äî —Ü–µ –ø—Ä–∞–≤–∏–ª–∞, –∑–∞ —è–∫–∏–º–∏ –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä —Ñ–æ—Ä–º—É—î –≤–∏–∫–ª–∏–∫–∏ —Ñ—É–Ω–∫—Ü—ñ–π –Ω–∞ ARM.**

–£ Cortex-M –≤—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –º–∞–π–∂–µ –∑–∞–≤–∂–¥–∏ (EABI, ELF, GCC, Keil, Clang).

---

# üü¶ **–ì–æ–ª–æ–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ AAPCS**

## üü© 1. –ü–µ—Ä–µ–¥–∞—á–∞ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ —á–µ—Ä–µ–∑ —Ä–µ–≥—ñ—Å—Ç—Ä–∏

–ü–µ—Ä—à—ñ 4 –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—å—Å—è –≤ —Ä–µ–≥—ñ—Å—Ç—Ä–∏:

| –ê—Ä–≥—É–º–µ–Ω—Ç | –†–µ–≥—ñ—Å—Ç—Ä |
| -------- | ------- |
| 1        | R0      |
| 2        | R1      |
| 3        | R2      |
| 4        | R3      |

–Ø–∫—â–æ –∞—Ä–≥—É–º–µ–Ω—Ç—ñ–≤ –±—ñ–ª—å—à–µ ‚Äî –Ω–∞—Å—Ç—É–ø–Ω—ñ –π–¥—É—Ç—å —É **—Å—Ç–µ–∫**.

---

## üü© 2. –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É

–§—É–Ω–∫—Ü—ñ—è –ø–æ–≤–µ—Ä—Ç–∞—î –∑–Ω–∞—á–µ–Ω–Ω—è –≤:

* **R0** ‚Üí –¥–ª—è –±—ñ–ª—å—à–æ—Å—Ç—ñ —Ç–∏–ø—ñ–≤
* **R0 + R1** ‚Üí –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä/64-–±—ñ—Ç–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å

---

## üü© 3. –†–æ–∑–ø–æ–¥—ñ–ª —Ä–µ–≥—ñ—Å—Ç—Ä—ñ–≤: ‚Äúcallee-saved‚Äù —Ç–∞ ‚Äúcaller-saved‚Äù

### **Caller-saved (–≤–∏–∫–ª–∏–∫–∞—é—á–∏–π –º–∞—î –∑–±–µ—Ä–µ–≥—Ç–∏):**

* R0, R1, R2, R3 ‚Üí –∞—Ä–≥—É–º–µ–Ω—Ç–∏
* R12
* LR —á–∞—Å—Ç–∫–æ–≤–æ
* R14 —ñ–Ω–æ–¥—ñ

–Ø–∫—â–æ –≤–∏–∫–ª–∏–∫–∞—é—á–∞ —Ñ—É–Ω–∫—Ü—ñ—è —Ö–æ—á–µ –∑–±–µ—Ä–µ–≥—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ R0‚ÄìR3 ‚Äî –≤–æ–Ω–∞ —Å–∞–º–∞ –ø—É—à–∏—Ç—å —ó—Ö —É —Å—Ç–µ–∫.

### **Callee-saved (—Ñ—É–Ω–∫—Ü—ñ—è –∑–æ–±–æ–≤‚Äô—è–∑–∞–Ω–∞ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –ø–µ—Ä–µ–¥ return):**

* R4, R5, R6, R7, R8, R9, R10, R11

–Ø–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î R4‚ÄìR11, –≤–æ–Ω–∞ **–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ** —Ä–æ–±–∏—Ç—å:

```asm
PUSH {R4-R7}
...
POP {R4-R7}
```

---

## üü© 4. –§–æ—Ä–º–∞—Ç —Å—Ç–µ–∫–∞

AAPCS –≤–∏–º–∞–≥–∞—î:

### ‚úî **–°—Ç–µ–∫ —Ä–æ—Å—Ç–µ –≤–Ω–∏–∑**

(–∞–¥—Ä–µ—Å–∏ –∑–º–µ–Ω—à—É—é—Ç—å—Å—è)

### ‚úî **SP –∑–∞–≤–∂–¥–∏ –≤–∏—Ä—ñ–≤–Ω—è–Ω–∏–π –Ω–∞ 8 –±–∞–π—Ç –ø–µ—Ä–µ–¥ –≤–∏–∫–ª–∏–∫–æ–º BL**

–Ü–Ω–∞–∫—à–µ ARM ABI –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ hard fault.

### ‚úî –°—Ç–µ–∫ –º—ñ—Å—Ç–∏—Ç—å:

* –∞—Ä–≥—É–º–µ–Ω—Ç–∏ >4-–≥–æ,
* –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —Ä–µ–≥—ñ—Å—Ç—Ä–∏,
* –ª–æ–∫–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ,
* –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω–Ω—è.

---

## üü© 5. –Ø–∫ –≤–∏–≥–ª—è–¥–∞—î –≤–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó –∑–∞ AAPCS?

–ü—Ä–∏–∫–ª–∞–¥:

```c
int add(int a, int b, int c, int d, int e);
```

–ü–µ—Ä–µ–¥–∞—á–∞:

* a ‚Üí R0
* b ‚Üí R1
* c ‚Üí R2
* d ‚Üí R3
* e ‚Üí –Ω–∞ —Å—Ç–µ–∫ (SP - 4)

---

# üü¶ **AAPCS —É Cortex-M –ø—ñ–¥ —á–∞—Å –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω–Ω—è**

–¶–µ –≤–∞–∂–ª–∏–≤–∞ —á–∞—Å—Ç–∏–Ω–∞.

–ü—Ä–∏ –≤—Ö–æ–¥—ñ –≤ interrupt:

–ü—Ä–æ—Ü–µ—Å–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ push‚Äô–∏—Ç—å:

```
R0, R1, R2, R3, R12, LR, PC, xPSR   (8 —Å–ª—ñ–≤)
```

–¶–µ –Ω–∞–∑–∏–≤–∞—î—Ç—å—Å—è **stack frame** ‚Äî —ñ –≤–æ–Ω–æ –ø–æ–≤–Ω—ñ—Å—Ç—é —Å—É–º—ñ—Å–Ω–µ –∑ AAPCS, —Ç–æ–±—Ç–æ –æ–±—Ä–æ–±–Ω–∏–∫ –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω—å –º–æ–∂–µ –≤–∏–≥–ª—è–¥–∞—Ç–∏ —è–∫ –∑–≤–∏—á–∞–π–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è.

---

# üü¶ **AAPCS —Ä–æ–±–∏—Ç—å —Å—É–º—ñ—Å–Ω–∏–º–∏:**

* –ø—Ä–æ—à–∏–≤–∫—É —Ç–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏,
* GCC/Clang/Keil/IAR,
* C —ñ ASM,
* –±—É–¥—å-—è–∫—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —É Cortex-M.

–¢–æ–º—É —è–∫—â–æ —Ç–∏ –ø–∏—à–µ—à ASM –¥–ª—è TM4C123 –∞–±–æ STM32, —Ç–æ–±—ñ —Ç—Ä–µ–±–∞ –¥–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—å —Ü–∏—Ö –ø—Ä–∞–≤–∏–ª, —ñ–Ω–∞–∫—à–µ –ø—Ä–æ–≥—Ä–∞–º–∞ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

---

# üü© –ü—Ä–∏–∫–ª–∞–¥: –º–∞–ª–µ–Ω—å–∫–∞ leaf-function (AAPCS-friendly)

```asm
add_numbers:
    ADD r0, r0, r1   ; R0 = R0 + R1
    BX lr            ; return
```

–ü–æ—è—Å–Ω–µ–Ω–Ω—è:

* –≤—Ö—ñ–¥–Ω—ñ –∞—Ä–≥—É–º–µ–Ω—Ç–∏ –≤ R0 —ñ R1
* —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –≤ R0
* —Ä–µ–≥—ñ—Å—Ç—Ä–∏ R4‚ÄìR11 –Ω–µ –∑–∞—á—ñ–ø–∞—é—Ç—å—Å—è ‚Üí –ø—É—à–∏—Ç–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ

---

# üü© –ü—Ä–∏–∫–ª–∞–¥ —Ñ—É–Ω–∫—Ü—ñ—ó, —è–∫–∞ –ø–æ–≤–∏–Ω–Ω–∞ –∑–±–µ—Ä–µ–≥—Ç–∏ —Ä–µ–≥—ñ—Å—Ç—Ä–∏

```asm
complex_func:
    PUSH {r4, r5, lr}

    MOV  r4, r0
    BL   calc1
    BL   calc2

    MOV  r0, r4
    POP  {r4, r5, lr}
    BX   lr
```

–í–æ–Ω–∞ –∑–±–µ—Ä—ñ–≥–∞—î R4, R5 —Ç–∞ LR, –±–æ AAPCS —Ü—å–æ–≥–æ –≤–∏–º–∞–≥–∞—î.

---

# üü¶ –ü—ñ–¥—Å—É–º–æ–∫ ‚Äî –≥–æ–ª–æ–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ AAPCS

| –©–æ –≤–∏–∑–Ω–∞—á–∞—î          | –Ø–∫                                             |
| -------------------- | ---------------------------------------------- |
| –ê—Ä–≥—É–º–µ–Ω—Ç–∏            | R0‚ÄìR3, —ñ–Ω—à—ñ —É —Å—Ç–µ–∫                             |
| –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è           | R0 (–∞–±–æ R0+R1)                                 |
| –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ä–µ–≥—ñ—Å—Ç—Ä—ñ–≤ | R4‚ÄìR11 –º–∞—é—Ç—å –±—É—Ç–∏ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω—ñ                   |
| –í–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó       | —á–µ—Ä–µ–∑ BL, SP –≤–∏—Ä—ñ–≤–Ω—è–Ω–∏–π –Ω–∞ 8 –±–∞–π—Ç              |
| –°—Ç–µ–∫                 | —Ä–æ—Å—Ç–µ –≤–Ω–∏–∑, –º—ñ—Å—Ç–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç–∏ —Ç–∞ –ª–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ |
| –ü–µ—Ä–µ—Ä–∏–≤–∞–Ω–Ω—è          | –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å stack frame             |

---

–Ø–∫—â–æ —Ö–æ—á–µ—à ‚Äî –º–æ–∂—É –Ω–∞–º–∞–ª—é–≤–∞—Ç–∏ ASCII-—Å—Ö–µ–º—É —Å—Ç–µ–∫–∞ –∞–±–æ –ø–æ–∫–∞–∑–∞—Ç–∏, —è–∫ –≤–∏–≥–ª—è–¥–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è —É —á–∏—Å—Ç–æ–º—É ASM –¥–ª—è TM4C123 –∑ –¥–æ—Ç—Ä–∏–º–∞–Ω–Ω—è–º AAPCS.
