–¢–∞–∫, —Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑—Ä–æ–∑—É–º—ñ–≤ ‚Äî –∞–ª–µ –¥–∞–≤–∞–π —Å—Ñ–æ—Ä–º—É–ª—é—î–º–æ —á—ñ—Ç–∫–æ –π –ø—Ä–æ—Å—Ç—ñ—à–µ.

–¢–≤–æ—î —Ä–µ—á–µ–Ω–Ω—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–µ:
**¬´–¢–æ–±—Ç–æ leaf function ‚Äî —Ü–µ —á–∞—Å—Ç–∏–Ω–∞ –¥–µ—Ä–µ–≤–∞, —è–∫–∞ —î –∫—ñ–Ω—Ü–µ–≤–æ—é –≥—ñ–ª–∫–æ—é —ñ –Ω–µ –≤–µ–¥–µ –¥–∞–ª—ñ?¬ª**

---

# ‚úî –¢–∞–∫! –°–∞–º–µ —Ç–∞–∫.

–£—è–≤–∏ **–¥–µ—Ä–µ–≤–æ –≤–∏–∫–ª–∏–∫—ñ–≤ —Ñ—É–Ω–∫—Ü—ñ–π** (call tree):

```
main()
 ‚îú‚îÄ‚îÄ funcA()
 ‚îÇ    ‚îú‚îÄ‚îÄ funcB()
 ‚îÇ    ‚îî‚îÄ‚îÄ funcC()
 ‚îî‚îÄ‚îÄ funcD()
```

–§—É–Ω–∫—Ü—ñ—ó, —è–∫—ñ –Ω–µ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å –Ω—ñ—á–æ–≥–æ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ —Å–µ–±–µ ‚Äî —Ü–µ **–ª–∏—Å—Ç–∫–∏ –¥–µ—Ä–µ–≤–∞**:

* `funcB()`
* `funcC()`
* `funcD()`

–¢–æ–º—É —ó—Ö —ñ –Ω–∞–∑–≤–∞–ª–∏:

### üëâ **leaf functions** ‚Äî ¬´–ª–∏—Å—Ç–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó¬ª, ¬´—Ñ—É–Ω–∫—Ü—ñ—ó-–ª–∏—Å—Ç–∫–∏¬ª.

---

# ‚úî –ß–æ–º—É –≤–∞–∂–ª–∏–≤–æ, —â–æ —Ü–µ "–∫—ñ–Ω–µ—Ü—å –≥—ñ–ª–∫–∏"?

–ë–æ:

* –≤–æ–Ω–∏ **–Ω–µ –≤–∏–∫–ª–∏–∫–∞—é—Ç—å —ñ–Ω—à–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π**
* –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å BL (—É ARM)
* **–Ω–µ —á—ñ–ø–∞—é—Ç—å LR**, –±–æ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –≤—ñ–¥—Ä–∞–∑—É `bx lr`
* —á–∞—Å—Ç–æ **–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —Å—Ç–µ–∫**
* –º–∞—é—Ç—å **–º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –º—ñ–∫—Ä–æ–∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∏–π –æ–≤–µ—Ä—Ö–µ–¥**

---

# ‚úî Leaf function –Ω–∞ ARM Cortex-M

–ü—Ä–∏–∫–ª–∞–¥ leaf function:

```c
int inc(int x) {
    return x + 1;
}
```

–ê—Å–µ–º–±–ª–µ—Ä:

```
inc:
    adds r0, r0, #1
    bx lr
```

–ù–µ–º–∞—î PUSH, POP, –Ω–µ–º–∞—î –≤–∏–∫–ª–∏–∫—É —ñ–Ω—à–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π ‚Üí **–ª–∏—Å—Ç**.

---

# ‚úî Non-leaf function:

```c
int wrapper(int x) {
    return inc(x);  // –≤–∏–∫–ª–∏–∫ —ñ–Ω—à–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó
}
```

–ê—Å–µ–º–±–ª–µ—Ä:

```
wrapper:
    push {lr}   ; LR —Ç—Ä–µ–±–∞ –∑–±–µ—Ä–µ–≥—Ç–∏
    bl inc      ; –≤–∏–∫–ª–∏–∫ —ñ–Ω—à–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó
    pop {pc}    ; –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è
```

–¶–µ –≤–∂–µ **–Ω–µ –ª–∏—Å—Ç–æ–∫**, –±–æ –º–∞—î —Å–≤–æ—ó ¬´–¥—ñ–ª—è–Ω–∫–∏¬ª ‚Äî —ñ–Ω—à—ñ —Ñ—É–Ω–∫—Ü—ñ—ó.

---

# üü¢ –ü—ñ–¥—Å—É–º–æ–∫

### ‚úî –¢–∞–∫, leaf function ‚Äî —Ü–µ ¬´–ª–∏—Å—Ç¬ª —É –¥–µ—Ä–µ–≤—ñ –≤–∏–∫–ª–∏–∫—ñ–≤

### ‚úî –í–æ–Ω–∞ –Ω—ñ—á–æ–≥–æ –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î

### ‚úî –í–æ–Ω–∞ ‚Äî –∫—ñ–Ω–µ—Ü—å –≥—ñ–ª–∫–∏

---

–Ø–∫ —Ö–æ—á–µ—à ‚Äî –ø–æ—è—Å–Ω—é —â–µ:

* —á–æ–º—É –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä –ª—é–±–∏—Ç—å leaf functions
* —è–∫ –æ–ø—Ç–∏–º—ñ–∑–∞—Ç–æ—Ä —Ä–æ–±–∏—Ç—å –∑ –Ω–∏—Ö inline
* —è–∫ –≤–∏–≥–ª—è–¥–∞—î —Å—Ç–µ–∫ –¥–ª—è leaf —ñ non-leaf

–°–∫–∞–∂–∏ —Ç—ñ–ª—å–∫–∏.
